!function(){function a(a,b){var c=.017453292519943295*b,d=Math.cos(c),e=Math.sin(c),f=a.x*d-a.y*e,g=a.x*e+a.y*d;return{x:parseFloat(f.toFixed(5)),y:parseFloat(g.toFixed(5))}}var b=function(a,b){this.svgContainer=a,b=p(b)?b:{},b.size=p(b.size)?b.size:15,b.resizeButtonColor=p(b.resizeButtonColor)?b.resizeButtonColor:"black",b.closeButtonColor=p(b.closeButtonColor)?b.closeButtonColor:"red",b.rotateButtonColor=p(b.rotateButtonColor)?b.rotateButtonColor:"orange",this.styles=b,this.container=void 0,this.resizeButton=e.rect({x:0,y:0,width:b.size,height:b.size,fill:b.resizeButtonColor,id:"resizeButton"}),this.closeButton=e.ellipse({x:0,y:0,width:b.size,height:b.size,fill:b.closeButtonColor,id:"closeButton"}),this.rotateButton=e.ellipse({x:0,y:0,width:b.size,height:b.size,fill:b.rotateButtonColor,id:"rotateButton"}),this.contour=c.createObject({type:"polyline",fill:"none",stroke:"black","stroke-dasharray":"5","stroke-width":"1"})};b.prototype.get=function(a){return this.container=c.createGroup(this.resizeButton,this.closeButton,this.rotateButton,this.contour),this.update(a),this.container},b.prototype.update=function(a){var b=n(a),c={width:b.width,height:b.height},e=a.getPosition(),f=d.getTransformAttribute(a,"rotate");null!=f&&d.setTransformAttribute(this.container,"rotate",f.join(" "));var g=this.styles.size/2;d.setTranslate(this.closeButton,e.x+c.width-g,e.y-g),a.resizable?d.setTranslate(this.resizeButton,e.x+c.width-g,e.y+c.height-g):d.setTranslate(this.resizeButton,-this.styles.size,-this.styles.size),a.rotatable?d.setTranslate(this.rotateButton,e.x-g+c.width/2,e.y-g):d.setTranslate(this.rotateButton,-this.styles.size,-this.styles.size);var h={x:e.x,y:e.y},i={x:e.x+c.width,y:e.y},j={x:e.x+c.width,y:e.y+c.height},k={x:e.x,y:e.y+c.height},l=h.x+","+h.y+" "+i.x+","+i.y+" "+j.x+","+j.y+" "+k.x+","+k.y+" "+h.x+","+h.y;this.contour.setAttribute("points",l)},b.prototype.hide=function(){void 0!=this.container&&(this.svgContainer.removeChild(this.container),this.container=void 0)};var c=new Object;c.createGroup=function(){for(var a=document.createElementNS("http://www.w3.org/2000/svg","g"),b=arguments.length;b--;)void 0!=arguments[b]&&a.appendChild(arguments[b]);return a},c.createObject=function(a){if(void 0!==a.type){var b=document.createElementNS("http://www.w3.org/2000/svg",a.type);delete a.type;for(var c in a)void 0!=a[c]&&("innerHTML"!=c?b.setAttribute(c,a[c]):b.innerHTML=a[c]);return b}};var d=new Object;d.getStandartAttributes=function(){return{matrix:void 0,translate:void 0,scale:void 0,rotate:void 0,skewX:void 0,skewY:void 0}},d.getTransformAttribute=function(a,b){var c=a.getAttribute("transform");if(void 0!=c){c=c.trim();var d=new RegExp("("+b+")\\(([\\d- \\-\\,\\.]+)\\)","i"),e=c.match(d);if(void 0!=e){for(var f=e[2].split(" "),g=f.length;g--;)f[g]=parseFloat(f[g]);return 1==f.length?f[0]:f}}},d.setTransformAttribute=function(a,b,c){for(var e,f=a.getAttribute("transform"),g=/([\w]+)(\([\d \-\,\.]+\))/g,h=d.getStandartAttributes();null!==(e=g.exec(f));)e[1]!=b&&(h[e[1]]=e[2]);h[b]="("+c+")";var i="";for(var j in h)void 0!=h[j]&&(i+=j+h[j]+" ");i=i.trim(),a.setAttribute("transform",i)},d.parseTransform=function(a){for(var b,c=/([\w]+)\(([\d \-\,\.]+)\)/g,d=[];null!==(b=c.exec(a));)d.push({attribute:b[1],value:b[2]});return d},d.getTransformAttributes=function(a){var b=a.getAttribute("transform");return d.parseTransform(b)},d.removeTransformAttribute=function(a,b){for(var c=this.getTransformAttributes(a),d="",e=c.length;e--;)c[e].attribute!=b&&(d+=c[e].attribute+"("+c[e].value+") ");d.trim(),a.setAttribute("transform",d)},d.addTranslate=function(a,b){var c,e=b.x,f=b.y,g=d.getTransformAttribute(a,"translate");void 0!=g?(g[0]+=e,g[1]+=f,c=g.join(" ")):c=e+" "+f,d.setTransformAttribute(a,"translate",c)},d.setTranslate=function(a,b,c){d.setTransformAttribute(a,"translate",b+" "+c)},d.getTranslate=function(a){var b=d.getTransformAttribute(a,"translate");return{x:b[0],y:b[1]}},d.addScale=function(a,b){var c,e=d.getTransformAttribute(a,"scale");void 0==e&&(e=[],e[0]=1,e[1]=1),e[0]+=b.x,e[1]+=b.y,c=e.join(" "),d.setTransformAttribute(a,"scale",c)},d.setScale=function(a,b,c){d.setTransformAttribute(a,"scale",b+" "+c)},d.getScale=function(a){var b=d.getTransformAttribute(a,"scale");return{width:b[0],height:b[1]}},d.rotate=function(a,b,c,e){d.setTransformAttribute(a,"rotate",e+" "+b+" "+c)};var e=new Object;e.__expand__=function(a,b){for(var c in b)Object.defineProperty(a,c,{value:b[c]})},e.rect=function(a){a.type="rect";var b=c.createObject(a);return e.__expand__(b,h),b},e.createFromDOM=function(a){for(var b=a.attributes,c=["hasControlElements","resizable","rotatable","snapToGrid","snapRotateToGrid"],d=c.map(function(a){return a.toLowerCase()}),f=b.length;f--;)if("true"==b[f].value){var g=d.indexOf(b[f].name);if(-1==g)continue;a[c[g]]=!!b[f].value,a.removeAttribute(b[f].name)}return e.__expand__(a,i[a.nodeName]),a},e.ellipse=function(a){a.type="ellipse",a.cx=a.x+a.width/2,a.cy=a.y+a.height/2,a.rx=a.width/2,a.ry=a.height/2,a.x=a.y=a.width=a.height=void 0;var b=c.createObject(a);return e.__expand__(b,f),b},e.path=function(a){a.type="path";var b=a.x,d=a.y,f=a.width,h=a.height;a.x=a.y=a.width=a.height=void 0;var i=c.createObject(a);return e.__expand__(i,g),i.setPosition(b,d),i.setSize(f,h),i},e.text=function(a){};var f=new Object;f.translate=function(a,b){this.setAttribute("cx",Number(this.getAttribute("cx"))+a),this.setAttribute("cy",Number(this.getAttribute("cy"))+b);var c=d.getTransformAttribute(this,"rotate");void 0!=c&&d.setTransformAttribute(this,"rotate",c[0]+" "+(c[1]+a)+" "+(c[2]+b))},f.getPosition=function(){var a=Number(this.getAttribute("cx")),b=Number(this.getAttribute("cy"));return{x:a-Number(this.getAttribute("rx")),y:b-Number(this.getAttribute("ry"))}},f.getSize=function(){return{width:2*Number(this.getAttribute("rx")),height:2*Number(this.getAttribute("ry"))}},f.setPosition=function(a,b){var c=this.getPosition(),d=a-c.x,e=b-c.y;this.translate(d,e)},f.setSize=function(a,b){var c=this.getSize();this.scale(a/c.width,b/c.height)},f.scale=function(a,b){var c=Number(this.getAttribute("cx")),d=Number(this.getAttribute("cy")),e=Number(this.getAttribute("rx")),f=Number(this.getAttribute("ry")),g=e-e*a,h=f-f*b;this.setAttribute("rx",e*a),this.setAttribute("ry",f*b),this.setAttribute("cx",c-g),this.setAttribute("cy",d-h)},f.rotate=function(a){var b=this.getPosition(),c=this.getSize();centerX=b.x+c.width/2,centerY=b.y+c.height/2,d.setTransformAttribute(this,"rotate",a+" "+centerX+" "+centerY)};var g=new Object;g.translate=function(a,b){for(var c=this.getAttribute("d").split(" "),e="",f=0;f<c.length;f++){var g=c[f].search(/[-0-9]+/);if(-1!=g){var h=c[f].slice(0,g),i=c[f].slice(g).split(",");i=i.map(function(c,d){return Number(c)+(0==d?a:b)}),e+=h+i.join(",")+" "}else e+=c[f]}this.setAttribute("d",e.trim());var j=d.getTransformAttribute(this,"rotate");void 0!=j&&d.setTransformAttribute(this,"rotate",j[0]+" "+(j[1]+a)+" "+(j[2]+b))},g.getPosition=function(){for(var a=this.getAttribute("d").split(" "),b=void 0,c=void 0,d=0;d<a.length;d++){var e=a[d].search(/[-0-9]+/);if(-1!=e){var f=(a[d].slice(0,e),a[d].slice(e).split(","));f=f.map(function(a,b){return Number(a)}),(f[0]<b||void 0==b)&&(b=f[0]),(f[1]<c||void 0==c)&&(c=f[1])}}return{x:b,y:c}},g.getSize=function(){for(var a=this.getAttribute("d").split(" "),b=void 0,c=void 0,d=void 0,e=void 0,f=0;f<a.length;f++){var g=a[f].search(/[-0-9]+/);if(-1!=g){var h=(a[f].slice(0,g),a[f].slice(g).split(","));h=h.map(function(a,b){return Number(a)}),(h[0]<b||void 0==b)&&(b=h[0]),(h[1]<c||void 0==c)&&(c=h[1]),(h[0]>d||void 0==d)&&(d=h[0]),(h[1]>e||void 0==e)&&(e=h[1])}}return{width:d-b,height:e-c}},g.setPosition=function(a,b){var c=this.getPosition(),d=a-c.x,e=b-c.y;this.translate(d,e)},g.setSize=function(a,b){var c=this.getSize();this.scale(a/c.width,b/c.height)},g.scale=function(a,b){for(var c=(this.getSize(),this.getPosition()),e=[a,b],f=this.getAttribute("d").split(" "),g="",h=0;h<f.length;h++){var i=f[h].search(/[-0-9]+/);if(-1!=i){var j=f[h].slice(0,i),k=f[h].slice(i).split(",");k=k.map(function(a,b){return Number(a)*e[b]}),g+=j+k.join(",")+" "}else g+=f[h]}this.setAttribute("d",g.trim());var l=this.getPosition(),m=l.x-c.x,n=l.y-c.y;this.translate(-m,-n);var o=d.getTransformAttribute(this,"rotate");void 0!=o&&this.rotate(o[0])},g.rotate=function(a){var b=this.getPosition(),c=this.getSize();centerX=b.x+c.width/2,centerY=b.y+c.height/2,d.setTransformAttribute(this,"rotate",a+" "+centerX+" "+centerY)};var h=new Object;h.translate=function(a,b){this.setAttribute("x",Number(this.getAttribute("x"))+a),this.setAttribute("y",Number(this.getAttribute("y"))+b);var c=d.getTransformAttribute(this,"rotate");void 0!=c&&d.setTransformAttribute(this,"rotate",c[0]+" "+(c[1]+a)+" "+(c[2]+b))},h.getPosition=function(){return{x:Number(this.getAttribute("x")),y:Number(this.getAttribute("y"))}},h.getSize=function(){return{width:Number(this.getAttribute("width")),height:Number(this.getAttribute("height"))}},h.setPosition=function(a,b){this.setAttribute("x",a),this.setAttribute("y",b)},h.setSize=function(a,b){this.setAttribute("width",a),this.setAttribute("height",b)},h.scale=function(a,b){this.setAttribute("width",Number(this.getAttribute("width"))*a),this.setAttribute("height",Number(this.getAttribute("height"))*b)},h.rotate=function(a){var b=this.getPosition(),c=this.getSize();centerX=b.x+c.width/2,centerY=b.y+c.height/2,d.setTransformAttribute(this,"rotate",a+" "+centerX+" "+centerY)};var i={rect:h,ellipse:f,path:g},j=function(a){this.svgEl=a.svg,this.cellSize=a.cellSize,this.moveStep=a.step,this.layers=[],this.layers.userCanvas=void 0,this.initUserCanvasLayer(),this.layers.grid=void 0,void 0!=this.cellSize&&this.initGridLayer(),this.layers.controlElements=void 0,this.initControlElementsLayer(),this.controlElements=new b(this.layers.controlElements,a.controlElementsStyles),this.userEvents=new k(this.cellSize,this.moveStep,this.controlElements),this.makeDraggable=this.userEvents.makeDraggable.bind(this.userEvents),this.factory=e;var c=function(a){a.target==this.svgEl&&void 0!=this.userEvents.controlElements&&this.userEvents.controlElements.hide()};this.svgEl.addEventListener("click",c.bind(this)),this.svgEl.addEventListener("touchend",c.bind(this))};j.prototype.initUserCanvasLayer=function(){this.layers.userCanvas=this.svgEl.appendChild(c.createGroup()),this.layers.userCanvas.setAttribute("id","userCanvas")},j.prototype.initGridLayer=function(){this.layers.grid=document.createElementNS("http://www.w3.org/2000/svg","g"),this.layers.grid.setAttribute("id","grid");for(var a=parseInt(this.svgEl.getAttribute("width")),b=parseInt(this.svgEl.getAttribute("height")),d=0;d<a;d+=this.cellSize){var e=c.createObject({type:"line",x1:d,y1:0,x2:d,y2:b,"stroke-width":1,stroke:"#333333"});this.layers.grid.appendChild(e)}for(var d=0;d<b;d+=this.cellSize){var e=c.createObject({type:"line",x1:0,y1:d,x2:a,y2:d,"stroke-width":1,stroke:"#333333"});this.layers.grid.appendChild(e)}this.svgEl.appendChild(this.layers.grid)},j.prototype.initControlElementsLayer=function(){this.layers.controlElements=c.createGroup(),this.layers.controlElements.setAttribute("id","controlElementsLayer"),this.svgEl.appendChild(this.layers.controlElements)},j.prototype.saveToSvg=function(){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("viewBox","0 0 "+this.svgEl.getAttribute("width")+" "+this.svgEl.getAttribute("height")),a.innerHTML+=this.layers.userCanvas.innerHTML;for(var b=this.layers.userCanvas.childNodes,c=a.childNodes,d=c.length;d--;)for(var e=Object.keys(b[d]),f=e.length;f--;)c[d].setAttribute(e[f],b[d][e[f]]);return prepareSvgCodeToSave(a,this.svgEl.getAttribute("width"),this.svgEl.getAttribute("height"))},j.prototype.loadFromSvg=function(a){var b=document.createElement("div");b.innerHTML=a;for(var c=b.firstChild,d=c.childNodes,e=d.length;e--;)if(d[e].nodeType!==Node.COMMENT_NODE&&-1!=Object.keys(i).indexOf(d[e].nodeName)){var f=this.factory.createFromDOM(d[e]);"draggableSvg"==f.getAttribute("class")&&this.userEvents.makeDraggable(f),this.layers.userCanvas.insertBefore(f,this.layers.userCanvas.firstChild)}},j.prototype.getSvgImageLink=function(){var a=prepareSvgCodeToSave(this.layers.userCanvas,this.svgEl.getAttribute("width"),this.svgEl.getAttribute("height"));return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a)},j.prototype.getImageLink=function(){return new Promise(function(a,b){var c=prepareSvgCodeToSave(this.layers.userCanvas,this.svgEl.getAttribute("width"),this.svgEl.getAttribute("height")),d="data:image/svg+xml;base64,"+btoa(c),e=document.createElement("canvas");e.setAttribute("width",parseInt(this.svgEl.getAttribute("width"))),e.setAttribute("height",parseInt(this.svgEl.getAttribute("height")));var f=e.getContext("2d"),g=new Image;g.src=d,g.onload=function(){f.drawImage(g,0,0);var b=e.toDataURL("image/png");a(b)}}.bind(this))},j.prototype.add=function(a){this.layers.userCanvas.appendChild(a),void 0!=this.userEvents.onChangeHandler&&this.userEvents.onChangeHandler()},j.prototype.getSelectedElement=function(){return this.userEvents.lastSelectedElement};var k=function(b,c,e){this.selectedElement=void 0,this.selectedElementClone=void 0,this.lastSelectedElement=void 0,this.onChangeHandler=void 0,this.onSelectHandler=void 0,this.onResizeHandler=void 0,this.onMoveHandler=void 0,this.onRotateHandler=void 0,this.dx=0,this.dy=0,this.currentX=0,this.currentY=0,this.controlElements=e,this.cellSize=b,this.baseElementSize=void 0!=this.cellSize?this.cellSize:20,this.moveStep=c,void 0!=this.cellSize&&(this.roundMoveStepNum=void 0!=this.moveStep?this.cellSize*this.moveStep:this.cellSize),this.selectElement=function(a){if(2!=a.button){this.selectedElement=a.target,this.selectedElementClone=this.selectedElement.cloneNode(),this.selectedElementClone.innerHTML=this.selectedElement.innerHTML,this.selectedElement.parentNode.appendChild(this.selectedElementClone),this.selectedElement.style.visibility="hidden",void 0!=this.controlElements&&this.controlElements.hide();var b=o(a);this.currentX=b.clientX,this.currentY=b.clientY,this.dx=0,this.dy=0,this.selectedElementClone.addEventListener("mousemove",this.moveElement),this.selectedElementClone.addEventListener("mouseout",this.deselectElement),this.selectedElementClone.addEventListener("mouseup",this.deselectElement),addEventListener("touchmove",this.moveElement),addEventListener("touchend",this.deselectElement)}}.bind(this),this.moveElement=function(a){var b=o(a);this.dx+=b.clientX-this.currentX,this.dy+=b.clientY-this.currentY,d.addTranslate(this.selectedElementClone,{x:this.dx,y:this.dy}),this.dx=0,this.dy=0,this.currentX=b.clientX,this.currentY=b.clientY}.bind(this),this.deselectElement=function(a){if(void 0!=this.selectedElementClone){if(void 0!=this.cellSize&&1==this.selectedElement.snapToGrid){var b=d.getTransformAttribute(this.selectedElementClone,"translate");void 0==b&&(b=[],b[0]=b[1]=0);var c=l(b[0],this.roundMoveStepNum),e=l(b[1],this.roundMoveStepNum);d.setTransformAttribute(this.selectedElementClone,"translate",c+" "+e)}var b=d.getTransformAttribute(this.selectedElementClone,"translate");void 0!=b&&this.selectedElement.translate(b[0],b[1]),this.selectedElement.style.visibility="visible",this.selectedElement.parentNode.removeChild(this.selectedElementClone),1==this.selectedElement.hasControlElements&&this.addControlElementsEvents(this.selectedElement),this.selectedElementClone.removeEventListener("mousemove",this.moveElement),this.selectedElementClone.removeEventListener("mouseout",this.deselectElement),this.selectedElementClone.removeEventListener("mouseup",this.deselectElement),removeEventListener("touchmove",this.moveElement),removeEventListener("touchend",this.deselectElement),this.lastSelectedElement=this.selectedElement,this.selectedElementClone=void 0,this.selectedElement=void 0,void 0!=this.onMoveHandler&&this.onMoveHandler(),void 0!=this.onSelectHandler&&this.onSelectHandler(),void 0!=this.onChangeHandler&&this.onChangeHandler()}}.bind(this),this.startResize=function(a){var b=o(a);this.currentX=b.clientX,this.currentY=b.clientY,addEventListener("mousemove",this.resize),addEventListener("touchmove",this.resize)}.bind(this),this.resize=function(b){if(2!=b.button){var c=o(b);dx=c.clientX-this.currentX,dy=c.clientY-this.currentY;var e={x:dx/this.lastSelectedElement.getBBox().width,y:dy/this.lastSelectedElement.getBBox().height},f=this.lastSelectedElement.getPosition(),g=d.getTransformAttribute(this.lastSelectedElement,"rotate");void 0!=g&&(d.removeTransformAttribute(this.lastSelectedElement,"rotate"),e=a(e,-g[0])),d.addScale(this.lastSelectedElement,e),d.setTransformAttribute(this.lastSelectedElement,"translate",f.x+" "+f.y);var h=this.lastSelectedElement.getAttribute("transform");h+=" translate("+-f.x+" "+-f.y+")",void 0!=g&&(h="rotate("+g[0]+" "+g[1]+" "+g[2]+") "+h),this.lastSelectedElement.setAttribute("transform",h),this.currentX=c.clientX,this.currentY=c.clientY,this.controlElements.update(this.lastSelectedElement),addEventListener("mouseup",this.finishResize),addEventListener("touchend",this.finishResize)}}.bind(this),this.finishResize=function(a){var b=(this.lastSelectedElement.getSize(),d.getTransformAttribute(this.lastSelectedElement,"scale")),c=this.lastSelectedElement.getSize();this.lastSelectedElement.scale(b[0],b[1]);var c=this.lastSelectedElement.getSize();if(d.removeTransformAttribute(this.lastSelectedElement,"scale"),d.removeTransformAttribute(this.lastSelectedElement,"translate"),void 0!=this.cellSize&&1==this.lastSelectedElement.snapToGrid){var c=this.lastSelectedElement.getSize(),e=l(c.width,this.roundMoveStepNum),f=l(c.height,this.roundMoveStepNum);this.lastSelectedElement.setSize(e,f),this.controlElements.update(this.lastSelectedElement)}var g=d.getTransformAttribute(this.lastSelectedElement,"rotate");if(void 0!=g){var g=d.getTransformAttribute(this.lastSelectedElement,"rotate");m(this.lastSelectedElement);this.lastSelectedElement.rotate(g[0]),this.controlElements.update(this.lastSelectedElement)}removeEventListener("mousemove",this.resize),removeEventListener("touchmove",this.resize),removeEventListener("mouseup",this.finishResize),removeEventListener("touchend",this.finishResize),void 0!=this.onResizeHandler&&this.onResizeHandler(),void 0!=this.onChangeHandler&&this.onChangeHandler()}.bind(this),this.startRotate=function(a){var b=o(a);this.currentX=b.clientX,this.currentY=b.clientY,addEventListener("mousemove",this.rotate),addEventListener("touchmove",this.rotate),addEventListener("mouseup",this.finishRotate),addEventListener("touchend",this.finishRotate)}.bind(this),this.rotate=function(a){if(2!=a.button){var b=o(a);dx=b.clientX-this.currentX,dy=b.clientY-this.currentY;var c=this.lastSelectedElement.getPosition(),d=this.lastSelectedElement.getSize();centerX=c.x+d.width/2,centerY=c.y+d.height/2,x=b.clientX-centerX,y=b.clientY-centerY,angle=-(270-180/Math.PI*Math.atan2(y,x)),this.lastSelectedElement.rotate(angle),this.controlElements.update(this.lastSelectedElement)}}.bind(this),this.finishRotate=function(a){var b=d.getTransformAttribute(this.lastSelectedElement,"rotate");if(this.lastSelectedElement.snapRotateToGrid&&void 0!=b){var c=b[0],e=l(c,45);d.setTransformAttribute(this.lastSelectedElement,"rotate",e+" "+b[1]+" "+b[2]),this.controlElements.update(this.lastSelectedElement)}removeEventListener("mousemove",this.rotate),removeEventListener("touchmove",this.rotate),removeEventListener("mouseup",this.finishRotate),removeEventListener("touchend",this.finishRotate),void 0!=this.onRotateHandler&&this.onRotateHandler(),void 0!=this.onChangeHandler&&this.onChangeHandler()}.bind(this),this.removeElement=function(a){var b=a.target.parentNode.parentNode.parentNode.getElementById("userCanvas");this.controlElements.hide(),b.removeChild(this.lastSelectedElement),this.lastSelectedElement=void 0,void 0!=this.onChangeHandler&&this.onChangeHandler()}.bind(this)};k.prototype.makeDraggable=function(a){a.setAttribute("class","draggableSvg"),a.setAttribute("style","position:relative;"),null==a.getAttribute("transform")&&a.setAttribute("transform",""),a.addEventListener("mousedown",this.selectElement),a.addEventListener("touchstart",this.selectElement)},k.prototype.addControlElementsEvents=function(a){var b=this.controlElements.get(a),c=a.parentNode.parentNode.getElementById("controlElementsLayer");this.controlElements.closeButton.addEventListener("mouseup",this.removeElement),this.controlElements.closeButton.addEventListener("touchend",this.removeElement),this.controlElements.resizeButton.addEventListener("mousedown",this.startResize),this.controlElements.resizeButton.addEventListener("touchstart",this.startResize),this.controlElements.rotateButton.addEventListener("mousedown",this.startRotate),this.controlElements.rotateButton.addEventListener("touchstart",this.startRotate),c.appendChild(b)},k.prototype.onChange=function(a){this.onChangeHandler=a},k.prototype.onSelect=function(a){this.onSelectHandler=a},k.prototype.onMove=function(a){this.onMoveHandler=a},k.prototype.onResize=function(a){this.onResizeHandler=a},k.prototype.onRotate=function(a){this.onRotateHandler=a};var l=function(a,b){return Math.round(a/b)*b},m=function(a){var b=document.body.getBoundingClientRect(),c=a.getBoundingClientRect(),d={};return d.y=c.top-b.top,d.x=c.left-b.left,d.width=c.width,d.height=c.height,d},n=function(a){var b=a.cloneNode();d.removeTransformAttribute(b,"rotate"),b.style.visibility="hidden",b.innerHTML=a.innerHTML,a.parentNode.appendChild(b);var c=m(b);return a.parentNode.removeChild(b),c},o=function(a){return p(a.touches)?a.touches[0]:a};prepareSvgCodeToSave=function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("viewBox","0 0 "+b+" "+c),d.innerHTML="\x3c!-- Created with SVG-edit - http://someurl.com --\x3e",d.innerHTML+=a.innerHTML;var e=new XMLSerializer,f=e.serializeToString(d);return f.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(f=f.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),f.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(f=f.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),f};var p=function(a){return void 0!==a};window.SvgEditor=j}();